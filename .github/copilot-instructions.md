# Mario Climbing Game â€” AI é–‹ç™¼æŒ‡å¼•

é€™æ˜¯ä¸€å€‹åŸºæ–¼ pygame çš„å‚ç›´æ”€çˆ¬éŠæˆ²ï¼Œæ¡ç”¨æ¨¡çµ„åŒ–æ¶æ§‹ã€‚æœ¬æŒ‡å¼•æ—¨åœ¨è®“ AI é–‹ç™¼ä»£ç†èƒ½ç«‹å³ç†è§£å°ˆæ¡ˆçµæ§‹ä¸¦é«˜æ•ˆç”¢å‡ºã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ§‹

### ä¸»è¦çµ„ä»¶

- **MarioClimbingGame** (`main.py`): éŠæˆ²ä¸»æ§åˆ¶å™¨ï¼Œç®¡ç†éŠæˆ²å¾ªç’° (handle_events â†’ update â†’ render, 60 FPS)
- **Player** (`src/characters/player.py`): è§’è‰²ç³»çµ±ï¼ŒåŒ…å«ç‰©ç†é‹ç®—ã€è¼¸å…¥è™•ç†ã€å¥—è£æŠ€èƒ½
- **LevelManager** (`src/levels/level_manager.py`): é—œå¡ç®¡ç†ï¼Œå‹•æ…‹ç”Ÿæˆ 6 é—œæŒ‘æˆ°ï¼ˆå« Boss æˆ°ï¼‰
- **EquipmentManager** (`src/equipment/equipment_manager.py`): 4 å¥—è£ç³»çµ±ï¼Œå¾ 1-4 ä»¶å¥—æ•ˆæœéå¢
- **EquipmentDropManager** (`src/equipment/equipment_item.py`): è™•ç†è£å‚™æ‰è½å’Œæ”¶é›†é‚è¼¯

### æ•¸æ“šæµå‘

```
Input â†’ Player.handle_input() â†’ Physics Update â†’ Collision Detection â†’
Equipment Effects â†’ Enemy AI â†’ Trap Updates â†’ Rendering â†’ UI Display
Enemy Death â†’ EquipmentDropManager.try_drop_item() â†’ Player Pickup â†’ Equipment Effects
```

### é—œéµç®¡ç†å™¨äº¤äº’æ¨¡å¼

```
Main Game Loop (main.py):
â”œâ”€â”€ Player.handle_input() + Player.update()  # ç©å®¶ç‰©ç†å’Œç‹€æ…‹
â”œâ”€â”€ LevelManager.update()                     # é—œå¡é™·é˜±å’Œæ•µäºº
â”œâ”€â”€ EquipmentManager.update()                 # å¥—è£æ•ˆæœæŒçºŒä½œç”¨
â”œâ”€â”€ FireballManager/IceballManager.update()  # å½ˆé“ç‰©ä»¶ç®¡ç†
â””â”€â”€ GameUI.render()                          # UI æ¸²æŸ“

Equipment Integration:
Player â†’ EquipmentManager â†’ Equipment Effects â†’ Player Stats Modification
```

### åŸºé¡æ¶æ§‹

- **BaseEnemy** (`src/enemies/base_enemy.py`): æ•µäººåŸºé¡ï¼Œå­é¡å¿…é ˆå¯¦ä½œ `update_ai()`, `render()`, `attack_player()`
- **BaseTrap** (`src/traps/base_trap.py`): é™·é˜±åŸºé¡ï¼Œå­é¡å¿…é ˆå¯¦ä½œ `update()`, `render()`, `_trigger_effect()`

## ğŸ“‹ é–‹ç™¼è¦ç¯„

### ä»£ç¢¼é¢¨æ ¼

- **èªè¨€**: æ‰€æœ‰è¨»è§£ã€docstring ä½¿ç”¨ç¹é«”ä¸­æ–‡
- **å‘½å**: è®Šæ•¸/å‡½å¼ `snake_case`ï¼Œé¡åˆ¥ `PascalCase`ï¼Œå¸¸æ•¸ `UPPER_CASE`
- **Docstring**: å¿…é ˆåŒ…å«åŠŸèƒ½èªªæ˜ã€åƒæ•¸ã€å›å‚³å€¼ï¼ˆç”¨ `\n` åˆ†è¡Œï¼‰
- **æ™‚é–“å–®ä½**: æ‰€æœ‰è¨ˆæ™‚å™¨ä»¥å¹€æ•¸è¨ˆç®—ï¼ˆ60 å¹€ â‰ˆ 1 ç§’ï¼‰
- **ä¸»ç¨‹å¼**: æª”æ¡ˆçµå°¾ç›´æ¥å‘¼å« `main()`ï¼Œä¸ä½¿ç”¨ `if __name__ == "__main__":`

### æ¨¡çµ„çµ„ç¹”åŸå‰‡

- **åŸºé¡å„ªå…ˆ**: æ–°åŠŸèƒ½å…ˆæª¢æŸ¥æ˜¯å¦æœ‰å°æ‡‰åŸºé¡ï¼ˆ`BaseEnemy`, `BaseTrap`ï¼‰
- **ç®¡ç†å™¨æ¨¡å¼**: è¤‡é›œç³»çµ±ä½¿ç”¨å°ˆç”¨ç®¡ç†å™¨ï¼ˆ`EquipmentManager`, `FireballManager`ï¼‰
- **çµ±ä¸€ä»‹é¢**: æ‰€æœ‰éŠæˆ²ç‰©ä»¶å¯¦ä½œ `get_collision_rect()` å’Œ `render(screen, camera_y)`
- **ç‹€æ…‹åˆ†é›¢**: UIã€ç‰©ç†ã€é‚è¼¯åˆ†åˆ¥è™•ç†ï¼Œé¿å…è€¦åˆ

### æ ¸å¿ƒæ¥å£è¦ç¯„

```python
# æ‰€æœ‰éŠæˆ²ç‰©ä»¶å¿…é ˆå¯¦ä½œ
def get_collision_rect() -> pygame.Rect
def render(screen: pygame.Surface, camera_y: float)

# é™·é˜±å­é¡åˆ¥å¿…é ˆå‘¼å«åŸºé¡æ–¹æ³•
def update(self):
    # ... å­é¡é‚è¼¯ ...
    self._update_base_properties()  # å¿…é ˆå‘¼å«

# æ•µäººå­é¡åˆ¥å¿…é ˆå‘¼å«åŸºé¡æ–¹æ³•
def update(self, player):
    # ... å­é¡é‚è¼¯ ...
    self._update_base_properties()  # å¿…é ˆå‘¼å«

# æ”å½±æ©Ÿç³»çµ±ä¸€è‡´æ€§ - æ‰€æœ‰æ¸²æŸ“æ–¹æ³•å¿…é ˆéµå¾ª
camera_y = player.y - SCREEN_HEIGHT // 2
screen_y = object.y - camera_y + SCREEN_HEIGHT // 2

# ç•«é¢å‰”é™¤å„ªåŒ– - é¿å…ç•«é¢å¤–ç‰©ä»¶æµªè²»æ•ˆèƒ½
def is_in_screen_bounds(self, screen, camera_y):
    screen_y = self.y - camera_y + screen.get_height() // 2
    return -50 <= screen_y <= screen.get_height() + 50
```

## ğŸ¯ å¸¸è¦‹é–‹ç™¼æ¨¡å¼

### æ–°å¢é™·é˜±

1. ç¹¼æ‰¿ `BaseTrap`ï¼Œå¯¦ä½œ `update()`, `render()`, `_trigger_effect()`
2. åœ¨ `update()` ä¸­å‘¼å« `self._update_base_properties()`
3. åœ¨ `LevelManager._create_level_N()` ä¸­åŠ å…¥å¯¦ä¾‹

### æ–°å¢æ•µäºº

1. ç¹¼æ‰¿ `BaseEnemy`ï¼Œå¯¦ä½œ `update_ai()`, `render()`, `attack_player()`
2. åœ¨é—œå¡çš„ `enemies` æ¸…å–®ä¸­åŠ å…¥å¯¦ä¾‹
3. æ­»äº¡æ‰è½åœ¨ `main._handle_enemy_drops()` è‡ªå‹•è™•ç†

### å½ˆé“ç³»çµ±ç®¡ç†

æ‰€æœ‰ç™¼å°„ç‰©ä»¶çµ±ä¸€ç”±å°ˆé–€ç®¡ç†å™¨è™•ç†ï¼š

- `FireballManager`: ç®¡ç†ç«ç„°å¥—è£æŠ€èƒ½ç™¼å°„çš„ç«çƒ
- `IceballManager`: ç®¡ç†å†°éœœå¥—è£æŠ€èƒ½ç™¼å°„çš„å†°çƒ
- åœ¨ `main.update()` ä¸­çµ±ä¸€æ›´æ–°æ‰€æœ‰ç®¡ç†å™¨
- å½ˆé“ç¢°æ’æª¢æ¸¬å’Œå‚·å®³è¨ˆç®—åœ¨ç®¡ç†å™¨å…§éƒ¨è™•ç†

### æ–°å¢æŠ•å°„ç‰©

1. ç¹¼æ‰¿åŸºç¤æŠ•å°„ç‰©é¡åˆ¥ï¼Œå¯¦ä½œ `update()`, `render()`, `check_collision()`
2. åœ¨å°æ‡‰ç®¡ç†å™¨ä¸­åŠ å…¥å¯¦ä¾‹ç”Ÿæˆå’Œæ›´æ–°é‚è¼¯
3. å¥—è£æŠ€èƒ½é€éç®¡ç†å™¨çš„ `add_projectile()` æ–¹æ³•ç™¼å°„

### è£å‚™æ‰è½æµç¨‹

```
Enemy Death â†’ EquipmentDropManager.try_drop_item() â†’ EquipmentItem
â†’ Player Pickup â†’ EquipmentManager.add_set_piece() â†’ Effect Updates
```

### è™•ç†è£å‚™æ’¿æ‹¾

ç©å®¶æ’¿æ‹¾é€é `EquipmentDropManager.check_pickup()` è‡ªå‹•è™•ç†ï¼š

- åœ¨ `main.update()` ä¸­æ¯å¹€æª¢æŸ¥æ’¿æ‹¾
- æˆåŠŸæ’¿æ‹¾æ™‚è‡ªå‹•å‘¼å« `equipment_manager.add_set_piece()`
- ç‰©å“å¾å ´æ™¯ä¸­ç§»é™¤ä¸¦æ›´æ–°ç©å®¶å¥—è£

## ğŸ”§ é™¤éŒ¯èˆ‡æ¸¬è©¦

### å¿«é€Ÿå•Ÿå‹•

```powershell
pip install pygame==2.5.2
python main.py
```

### é™¤éŒ¯æŠ€å·§

- **è·³éé—œå¡**: ä¿®æ”¹ `LevelManager.current_level_number`
- **è·³åˆ° Boss æˆ°**: éŠæˆ²ä¸­æŒ‰ `F6` ç›´æ¥è·³åˆ°ç¬¬å…­é—œæ¸¬è©¦
- **é‡ç½®é—œå¡**: éŠæˆ²ä¸­æŒ‰ `Q` é‡ç½®ç•¶å‰é—œå¡
- **ç„¡æ•µæ¨¡å¼**: è¨­å®š `player.invulnerability_time = 999`
- **å¿«é€Ÿæ¸¬è©¦**: æš«æ™‚è¨»è§£ `clock.tick(FPS)` åŠ é€ŸåŸ·è¡Œ
- **ç¢°æ’å¯è¦–åŒ–**: åœ¨ render æ–¹æ³•ä¸­ç¹ªè£½ `get_collision_rect()`
- **ç›¸æ©Ÿé™¤éŒ¯**: èª¿æ•´ `camera_smoothing` å€¼ï¼ˆ0.05-0.2ï¼‰æ§åˆ¶è·Ÿéš¨å¹³æ»‘åº¦

### å¸¸ç”¨é™¤éŒ¯å¿«æ·éµ

- `F6`: ç›´æ¥è·³åˆ°ç¬¬å…­é—œ Boss æˆ°
- `Q`: é‡ç½®ç•¶å‰é—œå¡
- `ESC`: æš«åœ/æ¢å¾©éŠæˆ²
- `1-4`: å¥—è£æŠ€èƒ½æ¸¬è©¦ï¼ˆéœ€è¦å°æ‡‰å¥—è£ï¼‰

### è§’è‰²èƒ½åŠ›é€ŸæŸ¥

- **è§’è‰² 0**: å¹³è¡¡ç‘ªè‰æ­ (è¡€é‡ 130, é€Ÿåº¦ 6, è·³èº 16, æ”»æ“Š 25)
- **è§’è‰² 1**: è·³è·³ç‘ªè‰æ­ (è¡€é‡ 100, é€Ÿåº¦ 4, è·³èº 17, æ”»æ“Š 20, **äºŒæ®µè·³èƒ½åŠ›**)
- **è§’è‰² 2**: å¦å…‹ç‘ªè‰æ­ (è¡€é‡ 150, é€Ÿåº¦ 5, è·³èº 15, æ”»æ“Š 28)

### æ³¨æ„äº‹é …

ç›®å‰åªæœ‰ 3 ç¨®è§’è‰²å¯é¸ï¼ˆ0-2ï¼‰ï¼Œé…ç½®åœ¨ `CHARACTER_CONFIGS` å¸¸æ•¸ä¸­

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### ç¢°æ’ç³»çµ±

- æ‰€æœ‰éŠæˆ²ç‰©ä»¶çš„ç¢°æ’æª¢æ¸¬åŸºæ–¼ `get_collision_rect()`
- ç©å®¶è¹²ä¸‹æ™‚ç¢°æ’çŸ©å½¢é«˜åº¦ç¸®å°ç‚ºä¸€åŠ
- å¹³å°ç¢°æ’å„ªå…ˆè™•ç†å‚ç›´æ–¹å‘ï¼Œå†è™•ç†æ°´å¹³æ–¹å‘

### å¥—è£ç³»çµ±æ•´åˆ

- å¥—è£æ•ˆæœåœ¨ `EquipmentManager.update()` ä¸­æŒçºŒä½œç”¨
- æŠ€èƒ½å¿«æ·éµï¼šæ•¸å­—éµ 1-4 å°æ‡‰ç«ç„°ã€å†°éœœã€å½±å­ã€å¦å…‹å¥—è£
- å¥—è£é¡è‰²æœƒå½±éŸ¿è§’è‰²æ¸²æŸ“å¤–è§€

### æ€§èƒ½è€ƒé‡

- æ¸²æŸ“å‰æª¢æŸ¥ `is_in_screen_bounds()` é¿å…ç•«é¢å¤–ç‰©ä»¶æµªè²»æ•ˆèƒ½
- æ•µäºº AI è·é›¢æª¢æ¸¬ä½¿ç”¨å¹³æ–¹è·é›¢é¿å…é–‹æ–¹é‹ç®—
- å‹•ç•«å¹€æ•¸å®šæœŸé‡ç½®é˜²æ­¢æ•¸å€¼æº¢å‡º

## ğŸ® éŠæˆ²ç‰¹è‰²å¯¦ä½œ

### çµ„åˆæŠ€èƒ½ç³»çµ±

- åŠ é€Ÿ + è·³èº = è·³èºé«˜åº¦æå‡ 30% (`jump_boost_multiplier = 1.3`)
- è·³èºç·©è¡æ©Ÿåˆ¶ï¼š8 å¹€å®¹éŒ¯æ™‚é–“æé«˜æ“ä½œæ‰‹æ„Ÿ

### Boss æˆ°æ©Ÿåˆ¶

- Boss ä½æ–¼ç¬¬ 6 é—œï¼ˆä¸æ˜¯ç¬¬ 5 é—œï¼‰ï¼Œå…·å‚™å¤šéšæ®µæ”»æ“Šæ¨¡å¼
- **åœ°é¢æ±ºæˆ°**ï¼šBoss ä½æ–¼åœ°é¢å·¦å´èˆ‡ç©å®¶æ­£é¢å°æ±ºï¼ˆè¦‹ `LEVEL6_BOSS_FIGHT.md`ï¼‰
- **é›œå…µè­·è¡›**ï¼šBoss é…å‚™å¤šå±¤æ¬¡è­·è¡›éƒ¨éšŠï¼Œå¿…é ˆå…¨éƒ¨æ“Šæ•—æ‰èƒ½å‹åˆ©
- ç¯„åœæ”»æ“Šã€å¬å–šå°å…µã€éœ‡æ³¢æ”»æ“Šç­‰ç‰¹æ®ŠæŠ€èƒ½
- è¡€é‡è®ŠåŒ–è§¸ç™¼ä¸åŒ AI è¡Œç‚ºæ¨¡å¼
- 100% æ‰è½ç‡ä¿è­‰çå‹µ

### è·³èºç·©è¡ç³»çµ±

- æŒ‰ä¸‹è·³èºéµæ™‚æä¾› 8 å¹€ç·©è¡æ™‚é–“ (`jump_buffer_time = 8`)
- æé«˜æ“ä½œæ‰‹æ„Ÿï¼Œæ¸›å°‘ã€ŒæŒ‰äº†æ²’è·³ã€çš„æƒ…æ³
- é…åˆ `previous_jump_key_pressed` å¯¦ç¾å–®æ¬¡è§¸ç™¼

### ç›¸æ©Ÿç³»çµ±è¨­è¨ˆ

- **å¹³æ»‘è·Ÿéš¨**ï¼šä½¿ç”¨ç·šæ€§æ’å€¼é¿å…ç›¸æ©ŸæŠ–å‹• (`camera_smoothing = 0.08`)
- **æ­»å€æ©Ÿåˆ¶**ï¼š5 åƒç´ æ­»å€æ¸›å°‘å¾®æŠ–å‹•
- **æ”å½±æ©ŸåŒæ­¥**ï¼šæ‰€æœ‰ render æ–¹æ³•çµ±ä¸€ä½¿ç”¨ `camera_y + SCREEN_HEIGHT // 2` è¨ˆç®—è¢å¹•åº§æ¨™
- **ç«‹å³æ›´æ–°**ï¼šé—œå¡åˆ‡æ›å’Œé‡ç½®æ™‚ç«‹å³è¨­å®šç›¸æ©Ÿä½ç½®ï¼Œé¿å…è·³èº

ç•¶éœ€è¦æ“´å±•åŠŸèƒ½æ™‚ï¼Œå„ªå…ˆæŸ¥é–±å°æ‡‰çš„åŸºé¡å’Œç®¡ç†å™¨ï¼Œéµå¾ªæ—¢æœ‰æ¨¡å¼å¯ç¢ºä¿ç³»çµ±æ•´åˆæ€§ã€‚
